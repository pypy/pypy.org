<html><body><p>Hello,</p>
<p>These last three weeks we have been busy working on the cpyext subsystem, which
allows pypy to execute extension modules written with the <a class="reference external" href="https://docs.python.org/c-api">Python C API</a>.</p>
<p>Today we hacked enough to have wxPython compile, and run its wonderful demo.
This:
<a href="https://imagebin.ca/img/hHtQJ9.png"><img alt="" border="0" src="https://imagebin.ca/img/hHtQJ9.png" style="display: block; margin: 0px auto 10px; text-align: center; cursor: pointer; cursor: hand; width: 970px; height: 720px;"></a>
cannot be distinguished from the same run with a
standard python interpreter, but this:
<a href="https://imagebin.ca/img/3nPX_sV.png"><img alt="" border="0" src="https://imagebin.ca/img/3nPX_sV.png" style="display: block; margin: 0px auto 10px; text-align: center; cursor: pointer; cursor: hand; width: 970px; height: 720px;"></a>
shows an exception that
CPython never produces.</p>
<p>wxPython is a big extension module: it has more than 500 classes and 7500
functions, most of the code is automatically generated by swig.  It uses
advanced techniques, like "Original Object Return" and cross-platform
polymorphism, that effectively allows the developer to seamlessly subclass C++
objects in Python and write GUI applications efficiently.</p>
<p>The demo application runs reasonably fast, it feels slower than with CPython,
but I did not activate the JIT option of pypy.  It still crashes in some places
(the demo is very comprehensive and covers all the aspects of wxPython), and
threads are expected to not work at the moment.</p>
<p>We had to modify a little the code of wxPython, mainly because it often stores
borrowed references into C++ objects.  This does not work well in pypy, where
all other counted references can disappear, and allows the address of the object
to change.  The solution is to use weak references instead.  The patch is <a class="reference external" href="https://codespeak.net/svn/user/afa/wxpython-for-pypy.diff">here</a>,
it will eventually be merged into the upstream wxPython version.</p>
<p>This first real test proves that CPython extensions can be migrated to pypy
without much pain.  It also points some places which can be improved, like
better diagnostics in crashes, better support of distutils...</p>
<p>Amaury Forgeot d'Arc</p></body></html>