<!DOCTYPE html>
<html \ prefix="
        og: http://ogp.me/ns# article: http://ogp.me/ns/article#
    " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Using CPython extension modules with PyPy, or: PyQt on PyPy | PyPy</title>
<link href="../../../assets/css/rst_base.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_rst.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/styles.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../../rss.xml">
<link rel="canonical" href="https://www.pypy.org/posts/2009/11/using-cpython-extension-modules-with-4951018896657992031.html">
<link rel="icon" href="../../../favicon2.ico" sizes="16x16">
<link rel="icon" href="../../../favicon32x32.ico" sizes="32x32">
<!--[if lt IE 9]><script src="../../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="../../../assets/css/tipuesearch.css">
<meta name="author" content="Alexander Schremmer">
<link rel="prev" href="some-benchmarking-9211261260383281459.html" title="Some benchmarking" type="text/html">
<link rel="next" href="../12/leysin-winter-sprint-23-30th-january-7768876505015446348.html" title="Leysin Winter Sprint: reported" type="text/html">
<meta property="og:site_name" content="PyPy">
<meta property="og:title" content="Using CPython extension modules with PyPy, or: PyQt on PyPy">
<meta property="og:url" content="https://www.pypy.org/posts/2009/11/using-cpython-extension-modules-with-4951018896657992031.html">
<meta property="og:description" content="If you have ever wanted to use CPython extension modules on PyPy,
we want to announce that there is a solution that should be compatible
to quite a bit of the available modules. It is neither new nor ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2009-11-30T11:19:00Z">
<meta property="article:tag" content="CPython">
<meta property="article:tag" content="extension modules">
<meta property="article:tag" content="PyQt4">
<meta property="article:tag" content="RPyC">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="container">
             <header id="header"><!-- Adapted from https://www.taniarascia.com/responsive-dropdown-navigation-bar --><section class="navigation"><div class="nav-container">
            <div class="brand">
                <a href="../../../index.html">
                    <image id="toplogo" src="../../../images/pypy-logo.svg" width="75px;" alt="PyPy/"></image></a>
            </div>
            <nav><ul class="nav-list">
<li> 
                <a href="#!">Features</a>
                <ul class="nav-dropdown">
<li> <a href="../../../features.html">What is PyPy?</a> </li>  
                    <li> <a href="../../../compat.html">Compatibility</a> </li>  
                    <li> <a href="../../../performance.html">Performance</a> </li>  
                </ul>
</li>
          <li> <a href="../../../download.html">Download</a> </li>  
          <li> <a href="http://doc.pypy.org">Dev Docs</a> </li>  
            <li> 
                <a href="#!">Blog</a>
                <ul class="nav-dropdown">
<li> <a href="../../../blog/">Index</a> </li>  
                    <li> <a href="../../../categories/">Tags</a> </li>  
                    <li> <a href="../../../archive.html">Archive by year</a> </li>  
                    <li> <a href="../../../rss.xml">RSS feed</a> </li>  
                    <li> <a href="https://morepypy.blogspot.com/">Old site</a> </li>  
                </ul>
</li>
            <li> 
                <a href="#!">About</a>
                <ul class="nav-dropdown">
<li> <a href="https://bsky.app/profile/pypyproject.bsky.social">Bluesky</a> </li>  
                    <li> <a href="https://libera.irclog.whitequark.org/pypy">IRC logs</a> </li>  
                    <li> <a href="https://www.youtube.com/playlist?list=PLADqad94yVqDRQXuqxKrPS5QnVqbDLlRt">YouTube</a> </li>  
                    <li> <a href="https://www.twitch.tv/pypyproject">Twitch</a> </li>  
                    <li> <a href="../../../pypy-sponsors.html">Sponsors</a> </li>  
                    <li> <a href="../../../howtohelp.html">How To Help?</a> </li>  
                    <li> <a href="../../../contact.html">Contact</a> </li>  
                </ul>
</li>

                </ul></nav><div class="nav-mobile">
                <a id="nav-toggle" href="#!"> <span></span></a>
            </div>
        </div>
    </section><div class="searchform" role="search">
                
<form class="navbar-form navbar-left" action="../../../search.html" role="search">
    <div class="form-group">
        <input type="text" class="form-control" id="tipue_search_input" name="q" placeholder="Searchâ€¦" autocomplete="off">
</div>
    <input type="submit" value="Local Search" style="visibility: hidden;">
</form>

            </div>
    </header><main id="content"><article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><div class="post">
          <header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Using CPython extension modules with PyPy, or: PyQt on PyPy</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../../authors/alexander-schremmer.html">Alexander Schremmer</a>
            </span></p>
            <p class="dateline">
            <a href="#" rel="bookmark">
            <time class="published dt-published" datetime="2009-11-30T11:19:00Z" itemprop="datePublished" title="2009-11-30 11:19">2009-11-30 11:19</time></a>
            </p>
                <p class="commentline">11 comments</p>

                <p class="commentline">            <a href="using-cpython-extension-modules-with-4951018896657992031.html#utterances-thread">Comments</a>


            
        </p>
</div>
        
    </header><div class="e-content entry-content" itemprop="articleBody text">
      <div class="document" id="using-cpython-extension-modules-with-pypy-or-pyqt-on-pypy">

<p>If you have ever wanted to use CPython extension modules on PyPy,
we want to announce that there is a solution that should be compatible
to quite a bit of the available modules. It is neither new nor written
by us, but works nevertheless great with PyPy.</p>
<p>The trick is to use RPyC, a transparent, symmetric remote procedure
call library written in Python. The idea is to start a
CPython process that hosts the PyQt libraries
and connect to it via TCP to send RPC commands to it.</p>
<p>I tried to run PyQt applications
using it on PyPy and could get quite a bit of the functionality of these
working. Remaining problems include regular segfaults of CPython
because of PyQt-induced memory corruption and bugs because classes
like StandardButtons behave incorrectly when it comes to arithmetical operations.</p>
<p>Changes to RPyC needed to be done to support remote unbound <tt class="docutils literal"><span class="pre">__init__</span></tt> methods,
shallow call by value for list and dict types (PyQt4 methods want real lists and dicts
as parameters), and callbacks to methods (all remote method objects are wrapped into
small lambda functions to ease the call for PyQt4).</p>
<p>If you want to try RPyC to run the PyQt application of your choice, you just
need to follow these steps. Please report your experience here in the blog
comments or on our <a class="reference external" href="https://codespeak.net/mailman/listinfo/pypy-dev">mailing list</a>.</p>
<blockquote>
<ol class="arabic simple">
<li>Download RPyC from the <a class="reference external" href="https://sourceforge.net/projects/rpyc/files/">RPyC download page</a>.</li>
<li>Download this <a class="reference external" href="https://codespeak.net/svn/user/xoraxax/rpyc-3.0.7-pyqt4-compat.patch">patch</a> and apply it to RPyC by running
<tt class="docutils literal"><span class="pre">patch</span> <span class="pre">-p1</span> <span class="pre">&lt;</span> <span class="pre">rpyc-3.0.7-pyqt4-compat.patch</span></tt> in the RPyC directory.</li>
<li>Install RPyc by running <tt class="docutils literal"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">install</span></tt> as root.</li>
<li>Run the file <tt class="docutils literal"><span class="pre">rpyc/servers/classic_server.py</span></tt> using CPython.</li>
<li>Execute your PyQt application on PyPy.</li>
</ol>
</blockquote>
<p>PyPy will automatically connect to CPython and use its PyQt libraries.</p>
<p>Note that this scheme works with nearly every extension library. Look
at <tt class="docutils literal"><span class="pre">pypy/lib/sip.py</span></tt> on how to add new libraries (you need to create
such a file for every proxied extension module).</p>
<p>Have fun with PyQt</p>
<p>Alexander Schremmer</p>
</div>
      </div>
      <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../categories/cpython.html" rel="tag">CPython</a></li>
            <li><a class="tag p-category" href="../../../categories/extension-modules.html" rel="tag">extension modules</a></li>
            <li><a class="tag p-category" href="../../../categories/pyqt4.html" rel="tag">PyQt4</a></li>
            <li><a class="tag p-category" href="../../../categories/rpyc.html" rel="tag">RPyC</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="some-benchmarking-9211261260383281459.html" rel="prev" title="Some benchmarking">Previous post</a>
            </li>
            <li class="next">
                <a href="../12/leysin-winter-sprint-23-30th-january-7768876505015446348.html" rel="next" title="Leysin Winter Sprint: reported">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
                <div class="comment-level comment-level-1">
      <div class="comment comment-8568365684451396370">
        <div class="comment-header">
          <a name="comment-8568365684451396370"></a>
            <span class="author">intgr</span> wrote on <span class="date">2009-11-30 13:03</span>:
        </div>
        <div class="comment-content">
          <p>OT: you should separate labels by commas, so that Blogspot recognizes them as distinct labels.</p>
        </div>
      </div>
      <div class="comment comment-4235888616722379108">
        <div class="comment-header">
          <a name="comment-4235888616722379108"></a>
            <span class="author">Carl Friedrich Bolz-Tereick</span> wrote on <span class="date">2009-11-30 13:08</span>:
        </div>
        <div class="comment-content">
          <p>intgr: Thanks, done.</p>
        </div>
      </div>
      <div class="comment comment-1060986143341684317">
        <div class="comment-header">
          <a name="comment-1060986143341684317"></a>
            <span class="author">Anonymous</span> wrote on <span class="date">2009-11-30 19:38</span>:
        </div>
        <div class="comment-content">
          <i>"regular segfaults of CPython because of PyQt-induced memory corruption and bugs because classes like StandardButtons behave incorrectly when it comes to arithmetical operations."</i><br><br>These sound interesting. Could you please elaborate? A link would suffice, if these are already documented by non-pypy people. Thanks!
        </div>
      </div>
      <div class="comment comment-190709316313910236">
        <div class="comment-header">
          <a name="comment-190709316313910236"></a>
            <span class="author">holger krekel</span> wrote on <span class="date">2009-12-01 09:17</span>:
        </div>
        <div class="comment-content">
          <p>cool stuff, alexander!  Generic access to all CPython-provided extension could remove an importing blocker for PyPy usage, allows incremental migrations.<br><br>Besides, I wonder if having two processes, one for application and one for bindings can have benefits to stability.</p>
        </div>
      </div>
      <div class="comment comment-2664824103021592579">
        <div class="comment-header">
          <a name="comment-2664824103021592579"></a>
            <span class="author">Alexander Schremmer</span> wrote on <span class="date">2009-12-01 10:28</span>:
        </div>
        <div class="comment-content">
          <p>Dear anonymous,<br><br>the StandardButtons bug was already communicated to a Nokia employee.<br>If you are interested in the segfaults, contact me and I give you the source code that I used for testing.</p>
        </div>
      </div>
      <div class="comment comment-6220156639911869530">
        <div class="comment-header">
          <a name="comment-6220156639911869530"></a>
            <span class="author">Zemantic dreams</span> wrote on <span class="date">2009-12-03 06:33</span>:
        </div>
        <div class="comment-content">
          <p>This is an important step forward!<br><br>There are probably two reasons why people use extensions: bindings to libraries and performance.<br><br>Unfortunately this specific approach does not address performance. Is there anything on horizon that would allow near-CPython API for extensions. So modules would just need to be recompiled against PyPy bindings for CPython API? Probably not 100% compatible, but close? <br><br>Any chances of that happening?<br><br>Andraz Tori, Zemanta</p>
        </div>
      </div>
      <div class="comment comment-9030014440801675881">
        <div class="comment-header">
          <a name="comment-9030014440801675881"></a>
            <span class="author">Alexander Schremmer</span> wrote on <span class="date">2009-12-03 08:51</span>:
        </div>
        <div class="comment-content">
          <i>Any chances of that happening?</i><br><br>In theory, this is possible, but a lot of work. Nobody has stepped up to implement it, yet.
        </div>
      </div>
      <div class="comment comment-6599608327711919678">
        <div class="comment-header">
          <a name="comment-6599608327711919678"></a>
            <span class="author">Unhelpful</span> wrote on <span class="date">2009-12-04 07:08</span>:
        </div>
        <div class="comment-content">
          <p>Isn't the exposure of refcounts in the CPython C API going to be a bit of a problem for implementing the API on pypy? perhaps a "fake" refcount could be associated with an object when it is first passed to an extension? This could still be problematic if the extension code expects to usefully manipulate the refcount, or to learn anything by examining it...</p>
        </div>
      </div>
      <div class="comment comment-9211653648225416075">
        <div class="comment-header">
          <a name="comment-9211653648225416075"></a>
            <span class="author">Alexander Schremmer</span> wrote on <span class="date">2009-12-04 10:10</span>:
        </div>
        <div class="comment-content">
          <i>Isn't the exposure of refcounts in the CPython C API going to be a bit of a problem for implementing the API on pypy?</i><br><br>Indeed, it would be part of the task to introduce support in the GCs for such refcounted objects. Note that real refcounting is necessary because the object could be stored in an C array, invisible to the GC.
        </div>
      </div>
      <div class="comment comment-6199212925361628366">
        <div class="comment-header">
          <a name="comment-6199212925361628366"></a>
            <span class="author">Unhelpful</span> wrote on <span class="date">2009-12-04 10:32</span>:
        </div>
        <div class="comment-content">
          <p>I'm trying to think of ways around that, but any API change to make objects held only in extensions trackable by the GC would probably be much worse than adding refcounted objects, wouldn't it, unless the extension were written in rpython...</p>
        </div>
      </div>
      <div class="comment comment-5431829179838110417">
        <div class="comment-header">
          <a name="comment-5431829179838110417"></a>
            <span class="author">handsomegui</span> wrote on <span class="date">2015-04-28 15:16</span>:
        </div>
        <div class="comment-content">
          <p>Any news on this PyQt on PyPy topic? With the latest PyPy 2.5.1? Thanks.</p>
        </div>
      </div>
         </div>

          </section>
</div>
    <div class="sidebar">
<div>
  <h2>
    The PyPy blogposts
  </h2>
  <div>
    Create a guest post via a PR to the <a href="https://github.com/pypy/pypy.org">source repo</a>
  </div>
</div>
    <div id="global-recent-posts">
    <h2>
      Recent Posts
    </h2>
    <ul class="post-list">
      <li>
        <a href="/posts/2025/07/pypy-v7320-release.html" class="listtitle">PyPy v7.3.20 release</a>
      </li>
      <li>
        <a href="/posts/2025/06/rpython-gc-allocation-speed.html" class="listtitle">How fast can the RPython GC allocate?</a>
      </li>
      <li>
        <a href="/posts/2025/04/prospero-in-rpython.html" class="listtitle">Doing the Prospero-Challenge in RPython</a>
      </li>
      <li>
        <a href="/posts/2025/02/pypy-v7319-release.html" class="listtitle">PyPy v7.3.19 release</a>
      </li>
      <li>
        <a href="/posts/2025/02/pypy-gc-sampling.html" class="listtitle">Low Overhead Allocation Sampling with VMProf in PyPy's GC</a>
      </li>
      <li>
        <a href="/posts/2025/02/pypy-v7318-release.html" class="listtitle">PyPy v7.3.18 release</a>
      </li>
      <li>
        <a href="/posts/2025/01/musings-tracing.html" class="listtitle">Musings on Tracing in PyPy</a>
      </li>
      <li>
        <a href="/posts/2025/01/towards-pypy311-an-update.html" class="listtitle">Towards PyPy3.11 - an update</a>
      </li>
      <li>
        <a href="/posts/2024/11/guest-post-final-encoding-in-rpython.html" class="listtitle">Guest Post: Final Encoding in RPython Interpreters</a>
      </li>
      <li>
        <a href="/posts/2024/10/jit-peephole-dsl.html" class="listtitle">A DSL for Peephole Transformation Rules of Integer Operations in the PyPy JIT</a>
      </li>
    </ul>
  </div>

          <div id="global-archive-list">
          <h2>
            Archives
          </h2>
          <ul class="archive-level archive-level-1">
            <li><a class="reference" href="/2007/">2007</a> (19)
            </li>
            <li><a class="reference" href="/2008/">2008</a> (62)
            </li>
            <li><a class="reference" href="/2009/">2009</a> (38)
            </li>
            <li><a class="reference" href="/2010/">2010</a> (44)
            </li>
            <li><a class="reference" href="/2011/">2011</a> (43)
            </li>
            <li><a class="reference" href="/2012/">2012</a> (44)
            </li>
            <li><a class="reference" href="/2013/">2013</a> (46)
            </li>
            <li><a class="reference" href="/2014/">2014</a> (22)
            </li>
            <li><a class="reference" href="/2015/">2015</a> (20)
            </li>
            <li><a class="reference" href="/2016/">2016</a> (20)
            </li>
            <li><a class="reference" href="/2017/">2017</a> (13)
            </li>
            <li><a class="reference" href="/2018/">2018</a> (12)
            </li>
            <li><a class="reference" href="/2019/">2019</a> (12)
            </li>
            <li><a class="reference" href="/2020/">2020</a> (9)
            </li>
            <li><a class="reference" href="/2021/">2021</a> (10)
            </li>
            <li><a class="reference" href="/2022/">2022</a> (13)
            </li>
            <li><a class="reference" href="/2023/">2023</a> (6)
            </li>
            <li><a class="reference" href="/2024/">2024</a> (13)
            </li>
            <li><a class="reference" href="/2025/">2025</a> (8)
            </li>
          </ul>
        </div>


          <div id="global-tag-list">
          <h2>
            Tags
          </h2>
          <ul>
            <li><a class="reference" href="/categories/arm.html">arm</a> (2)</li>
            <li><a class="reference" href="/categories/benchmarking.html">benchmarking</a> (1)</li>
            <li><a class="reference" href="/categories/casestudy.html">casestudy</a> (3)</li>
            <li><a class="reference" href="/categories/cli.html">cli</a> (1)</li>
            <li><a class="reference" href="/categories/compiler.html">compiler</a> (1)</li>
            <li><a class="reference" href="/categories/conda-forge.html">conda-forge</a> (1)</li>
            <li><a class="reference" href="/categories/cpyext.html">cpyext</a> (4)</li>
            <li><a class="reference" href="/categories/cpython.html">CPython</a> (3)</li>
            <li><a class="reference" href="/categories/ep2008.html">ep2008</a> (1)</li>
            <li><a class="reference" href="/categories/extension-modules.html">extension modules</a> (3)</li>
            <li><a class="reference" href="/categories/gc.html">gc</a> (3)</li>
            <li><a class="reference" href="/categories/guestpost.html">guestpost</a> (3)</li>
            <li><a class="reference" href="/categories/graalpython.html">GraalPython</a> (1)</li>
            <li><a class="reference" href="/categories/hpy.html">hpy</a> (1)</li>
            <li><a class="reference" href="/categories/heptapod.html">Heptapod</a> (1)</li>
            <li><a class="reference" href="/categories/jit.html">jit</a> (23)</li>
            <li><a class="reference" href="/categories/jython.html">jython</a> (1)</li>
            <li><a class="reference" href="/categories/kcachegrind.html">kcachegrind</a> (1)</li>
            <li><a class="reference" href="/categories/meta.html">meta</a> (1)</li>
            <li><a class="reference" href="/categories/numpy.html">numpy</a> (24)</li>
            <li><a class="reference" href="/categories/parser.html">parser</a> (1)</li>
            <li><a class="reference" href="/categories/performance.html">performance</a> (2)</li>
            <li><a class="reference" href="/categories/profiling.html">profiling</a> (7)</li>
            <li><a class="reference" href="/categories/pypy.html">pypy</a> (6)</li>
            <li><a class="reference" href="/categories/pypy3.html">pypy3</a> (16)</li>
            <li><a class="reference" href="/categories/pyqt4.html">PyQt4</a> (1)</li>
            <li><a class="reference" href="/categories/release.html">release</a> (66)</li>
            <li><a class="reference" href="/categories/releasecffi.html">releasecffi</a> (3)</li>
            <li><a class="reference" href="/categories/releaserevdb.html">releaserevdb</a> (1)</li>
            <li><a class="reference" href="/categories/releasestm.html">releasestm</a> (1)</li>
            <li><a class="reference" href="/categories/revdb.html">revdb</a> (1)</li>
            <li><a class="reference" href="/categories/roadmap.html">roadmap</a> (2)</li>
            <li><a class="reference" href="/categories/rpython.html">rpython</a> (1)</li>
            <li><a class="reference" href="/categories/rpyc.html">RPyC</a> (1)</li>
            <li><a class="reference" href="/categories/speed.html">speed</a> (6)</li>
            <li><a class="reference" href="/categories/sponsors.html">sponsors</a> (7)</li>
            <li><a class="reference" href="/categories/sprint.html">sprint</a> (3)</li>
            <li><a class="reference" href="/categories/sprints.html">sprints</a> (1)</li>
            <li><a class="reference" href="/categories/stm.html">stm</a> (14)</li>
            <li><a class="reference" href="/categories/sun.html">sun</a> (1)</li>
            <li><a class="reference" href="/categories/smalltalk.html">Smalltalk</a> (1)</li>
            <li><a class="reference" href="/categories/squeak.html">Squeak</a> (1)</li>
            <li><a class="reference" href="/categories/testing.html">testing</a> (1)</li>
            <li><a class="reference" href="/categories/toy-optimizer.html">toy-optimizer</a> (5)</li>
            <li><a class="reference" href="/categories/unicode.html">unicode</a> (1)</li>
            <li><a class="reference" href="/categories/valgrind.html">valgrind</a> (1)</li>
            <li><a class="reference" href="/categories/vmprof.html">vmprof</a> (3)</li>
            <li><a class="reference" href="/categories/z3.html">z3</a> (5)</li>
          </ul>
        </div>    </div>
</article></main><footer id="footer"><p>
</p>
<div class="myfooter">
  <div class="logotext">
    Â© 2025 <a href="mailto:pypy-dev@pypy.org">The PyPy Team</a>
    Â 
    Built with <a href="https://getnikola.com" rel="nofollow">Nikola</a>
    Â 
    Last built 2025-07-07T11:01
  </div>
  <div style="margin-left: auto">
  <a href="../../../rss.xml">RSS feed</a>
</div>

            
        

    </div>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js" crossorigin="anonymous"></script><script src="../../../assets/js/styles.js"></script></footer>
</div>
</body>
</html>