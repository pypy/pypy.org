<!DOCTYPE html>
<html \ prefix="
        og: http://ogp.me/ns# article: http://ogp.me/ns/article#
    " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>General performance improvements | PyPy</title>
<link href="../../../assets/css/rst_base.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_rst.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/styles.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../../rss.xml">
<link rel="canonical" href="https://www.pypy.org/posts/2008/05/general-performance-improvements-838741900863354293.html">
<link rel="icon" href="../../../favicon2.ico" sizes="16x16">
<link rel="icon" href="../../../favicon32x32.ico" sizes="32x32">
<!--[if lt IE 9]><script src="../../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="../../../assets/css/tipuesearch.css">
<meta name="author" content="Armin Rigo">
<link rel="prev" href="next-sprint-berlin-may-17-22nd-may-5362899847460267375.html" title="Next Sprint: Berlin, May 17-22nd May" type="text/html">
<link rel="next" href="berlin-sprint-day-1-2-8761821946764492267.html" title="Berlin Sprint Day 1 + 2" type="text/html">
<meta property="og:site_name" content="PyPy">
<meta property="og:title" content="General performance improvements">
<meta property="og:url" content="https://www.pypy.org/posts/2008/05/general-performance-improvements-838741900863354293.html">
<meta property="og:description" content="Hi all,

During the past two weeks we invested some more efforts on the
baseline performance of pypy-c.  Some of the tweaks we did
were just new ideas, and others were based on actual
profiling.  The ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2008-05-10T17:34:00Z">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="container">
             <header id="header"><!-- Adapted from https://www.taniarascia.com/responsive-dropdown-navigation-bar --><section class="navigation"><div class="nav-container">
            <div class="brand">
                <a href="../../../index.html">
                    <image id="toplogo" src="../../../images/pypy-logo.svg" width="75px;" alt="PyPy/"></image></a>
            </div>
            <nav><ul class="nav-list">
<li> 
                <a href="#!">Features</a>
                <ul class="nav-dropdown">
<li> <a href="../../../features.html">What is PyPy?</a> </li>  
                    <li> <a href="../../../compat.html">Compatibility</a> </li>  
                    <li> <a href="../../../performance.html">Performance</a> </li>  
                </ul>
</li>
          <li> <a href="../../../download.html">Download</a> </li>  
          <li> <a href="http://doc.pypy.org">Dev Docs</a> </li>  
            <li> 
                <a href="#!">Blog</a>
                <ul class="nav-dropdown">
<li> <a href="../../../blog/">Index</a> </li>  
                    <li> <a href="../../../categories/">Tags</a> </li>  
                    <li> <a href="../../../archive.html">Archive by year</a> </li>  
                    <li> <a href="../../../rss.xml">RSS feed</a> </li>  
                    <li> <a href="https://morepypy.blogspot.com/">Old site</a> </li>  
                </ul>
</li>
            <li> 
                <a href="#!">About</a>
                <ul class="nav-dropdown">
<li> <a href="https://bsky.app/profile/pypyproject.bsky.social">Bluesky</a> </li>  
                    <li> <a href="https://libera.irclog.whitequark.org/pypy">IRC logs</a> </li>  
                    <li> <a href="https://www.youtube.com/playlist?list=PLADqad94yVqDRQXuqxKrPS5QnVqbDLlRt">YouTube</a> </li>  
                    <li> <a href="https://www.twitch.tv/pypyproject">Twitch</a> </li>  
                    <li> <a href="../../../pypy-sponsors.html">Sponsors</a> </li>  
                    <li> <a href="../../../howtohelp.html">How To Help?</a> </li>  
                    <li> <a href="../../../contact.html">Contact</a> </li>  
                </ul>
</li>

                </ul></nav><div class="nav-mobile">
                <a id="nav-toggle" href="#!"> <span></span></a>
            </div>
        </div>
    </section><div class="searchform" role="search">
                
<form class="navbar-form navbar-left" action="../../../search.html" role="search">
    <div class="form-group">
        <input type="text" class="form-control" id="tipue_search_input" name="q" placeholder="Searchâ€¦" autocomplete="off">
</div>
    <input type="submit" value="Local Search" style="visibility: hidden;">
</form>

            </div>
    </header><main id="content"><article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><div class="post">
          <header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">General performance improvements</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../../authors/armin-rigo.html">Armin Rigo</a>
            </span></p>
            <p class="dateline">
            <a href="#" rel="bookmark">
            <time class="published dt-published" datetime="2008-05-10T17:34:00Z" itemprop="datePublished" title="2008-05-10 17:34">2008-05-10 17:34</time></a>
            </p>
                <p class="commentline">11 comments</p>

                <p class="commentline">            <a href="general-performance-improvements-838741900863354293.html#utterances-thread">Comments</a>


            
        </p>
</div>
        
    </header><div class="e-content entry-content" itemprop="articleBody text">
      <p>Hi all,</p>

<p>During the past two weeks we invested some more efforts on the
baseline performance of pypy-c.  Some of the tweaks we did
were just new ideas, and others were based on actual
profiling.  The net outcome is that we now expect PyPy to be
in the worst case twice as slow than CPython on real
applications.  Here are some small-to-medium-size benchmark
results.  The number is the execution time, normalized to 1.0
for CPython 2.4:</p>

<p></p>
<ul>
<li>
<strong>1.90</strong> on templess (a simple templating language)</li>
<li>
<strong>1.49</strong> on gadfly (pure Python SQL database)</li>
<li>
<strong>1.49</strong> on translate.py (pypy's own translation toolchain)</li>
<li>
<strong>1.44</strong> on mako (another templating system)</li>
<li>
<strong>1.21</strong> on pystone</li>
<li>
<strong>0.78</strong> on richards</li>
</ul>
<p>(This is all without the JIT, as usual.  The JIT is not ready yet.)</p>

<p>You can build yourself a pypy-c with this kind of speed with
the magic command line (gcrootfinder is only for a 32-bit
Linux machine):</p>

<p></p>
<pre>    pypy/translator/goal/translate.py --gc=hybrid --gcrootfinder=asmgcc targetpypystandalone --allworkingmodules --faassen</pre>

<p>The main improvements come from:
    
</p>
<ul>
<li>A general shortcut for any operation between built-in objects:
for example, a subtraction of two integers or floats now dispatches
directly to the integer or float subtraction code, without looking up
the '__sub__' in the class.</li>
<li>A shortcut for getting attributes out of instances of user classes
when the '__getattribute__' special method is not overridden.</li>
<li>The so-called Hybrid Garbage Collector is now a
three-generations collector.
<a href="https://codespeak.net/pypy/dist/pypy/doc/garbage_collection.html">
More about our GCs...</a>
</li>
<li>Some profiling showed bad performance in our implementation of
the built-in id() -- a trivial function to write in CPython, but a lot
more fun when you have a moving GC and your object's real address can
change.</li>
<li>The bytecode compiler's parser had a very slow linear search
algorithm that we replaced with a dictionary lookup.</li>
</ul>
<p>These benchmarks are doing CPU-intensive operations. You can expect
a similar blog post soon about the I/O performance, as the
<code>io-improvements</code> branch gets closer to being merged
<code>:-)</code>  The branch could also improve the speed of
string operations, as used e.g. by the templating systems.</p>
      </div>
      <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="next-sprint-berlin-may-17-22nd-may-5362899847460267375.html" rel="prev" title="Next Sprint: Berlin, May 17-22nd May">Previous post</a>
            </li>
            <li class="next">
                <a href="berlin-sprint-day-1-2-8761821946764492267.html" rel="next" title="Berlin Sprint Day 1 + 2">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
                <div class="comment-level comment-level-1">
      <div class="comment comment-2511547946359067622">
        <div class="comment-header">
          <a name="comment-2511547946359067622"></a>
            <span class="author">Anonymous</span> wrote on <span class="date">2008-05-10 20:07</span>:
        </div>
        <div class="comment-content">
          <p>We had the same problem with id() (called object_id()) in Rubinius. We currently hide an objects's ID inside it's metaclass (allocating one if there isn't one).<br><br>Where did you guys store it?</p>
        </div>
      </div>
      <div class="comment comment-3474594539528628584">
        <div class="comment-header">
          <a name="comment-3474594539528628584"></a>
            <span class="author">Anonymous</span> wrote on <span class="date">2008-05-11 00:48</span>:
        </div>
        <div class="comment-content">
          <p>The ID is stored in a special dictionary (a normal dictionary specialized to be allocated so that the GC wont see it) that is used in the GC as a mapping from addresses to integers. This dict is updated when necessary (usually when collecting).</p>
        </div>
      </div>
      <div class="comment comment-2973827785945462860">
        <div class="comment-header">
          <a name="comment-2973827785945462860"></a>
            <span class="author">Unknown</span> wrote on <span class="date">2008-05-11 06:56</span>:
        </div>
        <div class="comment-content">
          <p>Wow. That sure is nice.</p>
        </div>
      </div>
      <div class="comment comment-6873233863739148768">
        <div class="comment-header">
          <a name="comment-6873233863739148768"></a>
            <span class="author">Anonymous</span> wrote on <span class="date">2008-05-11 07:27</span>:
        </div>
        <div class="comment-content">
          <p>My my, that must be a huge dictionary.</p>
        </div>
      </div>
      <div class="comment comment-7441149278025212551">
        <div class="comment-header">
          <a name="comment-7441149278025212551"></a>
            <span class="author">Anonymous</span> wrote on <span class="date">2008-05-11 09:12</span>:
        </div>
        <div class="comment-content">
          <p>The dictionary is of course only filled for objects that were used in an id() call.</p>
        </div>
      </div>
      <div class="comment comment-5933661760437003340">
        <div class="comment-header">
          <a name="comment-5933661760437003340"></a>
            <span class="author">Armin Rigo</span> wrote on <span class="date">2008-05-11 09:19</span>:
        </div>
        <div class="comment-content">
          <p>There are actually two dictionaries, at least when using one of the generational GCs: one for the first generation objects and one for the rest.  The dictionary for the rest of the objects can probably get quite large, but it needs to be traversed once during each full collection only.  It seems that full collections are rare enough: the full dictionary updating doesn't stand out in profiled runs.<br><br>I didn't think about implementing id() at the language level, e.g. by extending the class of the object to add a field. <br>We can't really do that in RPython.  Moreover, that seems impractical for Python: if someone asks for the id() of an integer object, do all integers suddenly need to grow an 'id' field?</p>
        </div>
      </div>
      <div class="comment comment-5605943787418740012">
        <div class="comment-header">
          <a name="comment-5605943787418740012"></a>
            <span class="author">Daivd</span> wrote on <span class="date">2008-05-11 09:41</span>:
        </div>
        <div class="comment-content">
          <p>Great work!<br><br>I have a few questions not answered by the FAQ that I hope someone will be able to answer.<br><br>When might the JIT be ready enough? (no stress, just asking :)<br><br>How much faster are CPython 2.5, 2.6 and 3.0? That seems to be relevant to the statement "we now expect PyPy to be in the worst case twice as slow than CPython".<br><br>If I understand correctly, one of the purposes of PyPy is to make experimentation easier - so will making it compatible with 3.0 be fairly easy? Are there plans to do so?<br><br>Is PyPy expected to one day become a serious "competitor" to CPython, in that you might want to run it in production? Is there a time set for when it will be ready for use by the general public (i.e me ;)?</p>
        </div>
      </div>
      <div class="comment comment-5789027349622540149">
        <div class="comment-header">
          <a name="comment-5789027349622540149"></a>
            <span class="author">Maciej Fijalkowski</span> wrote on <span class="date">2008-05-11 10:19</span>:
        </div>
        <div class="comment-content">
          <p>So, answering questions one by one:<br><br>JIT will be ready when it'll be ready, not earlier.<br><br>CPython 2.5 is slightly faster for some operations. No real difference there. 2.6 was optimized for certain operations, but as well, don't expect a huge difference. I think you can expect pypy to be in range of 2x for any cpython. 3.0 is not even sure how will look like, but certainly being ultra fast is not it's primary goal.<br><br>Regarding making pypy compatible with 3.0 - yes, that should be fairly easy although we don't have any immediate plans doing that.<br><br>The final date for making pypy production ready is not set (and this is a gradual process), but as you can see <a href="https://morepypy.blogspot.com/2008/03/bittorrent-on-pypy.html" rel="nofollow">here</a> and <a href="https://morepypy.blogspot.com/2008/02/running-pyglet-on-pypy.html" rel="nofollow">here</a> we're trying more and more to make it run existing applications.<br><br>Cheers,<br>fijal</p>
        </div>
      </div>
      <div class="comment comment-6019119433776739396">
        <div class="comment-header">
          <a name="comment-6019119433776739396"></a>
            <span class="author">Anonymous</span> wrote on <span class="date">2008-05-11 10:43</span>:
        </div>
        <div class="comment-content">
          <p>Note that current benchmarks suggest that CPython 3.0 is yet much slower than CPython 2.x. It might be interesting to see whether this means that PyPy is much faster than CPython 3.0 running e.g. Pystone. <br>Of course this fact would not be very surprising, esp. given that PyPy does not implement any CPy3k features.</p>
        </div>
      </div>
      <div class="comment comment-7381633538129806872">
        <div class="comment-header">
          <a name="comment-7381633538129806872"></a>
            <span class="author">Luis</span> wrote on <span class="date">2008-10-12 22:43</span>:
        </div>
        <div class="comment-content">
          <p>"JIT will be ready when it'll be ready, not earlier."<br><br>Alright, alright... we know.<br>But could you at least give us a very rough estimation for us, mere mortals? What does your heart tell you? :-)</p>
        </div>
      </div>
      <div class="comment comment-4721705338711564743">
        <div class="comment-header">
          <a name="comment-4721705338711564743"></a>
            <span class="author">Spencer</span> wrote on <span class="date">2009-11-02 18:04</span>:
        </div>
        <div class="comment-content">
          <p>What kind of computations are done in richards? I.e., what sort of applications can expect better perfomance in PyPy than in CPy?</p>
        </div>
      </div>
         </div>

          </section>
</div>
    <div class="sidebar">
<div>
  <h2>
    The PyPy blogposts
  </h2>
  <div>
    Create a guest post via a PR to the <a href="https://github.com/pypy/pypy.org">source repo</a>
  </div>
</div>
    <div id="global-recent-posts">
    <h2>
      Recent Posts
    </h2>
    <ul class="post-list">
      <li>
        <a href="/posts/2025/07/pypy-v7320-release.html" class="listtitle">PyPy v7.3.20 release</a>
      </li>
      <li>
        <a href="/posts/2025/06/rpython-gc-allocation-speed.html" class="listtitle">How fast can the RPython GC allocate?</a>
      </li>
      <li>
        <a href="/posts/2025/04/prospero-in-rpython.html" class="listtitle">Doing the Prospero-Challenge in RPython</a>
      </li>
      <li>
        <a href="/posts/2025/02/pypy-v7319-release.html" class="listtitle">PyPy v7.3.19 release</a>
      </li>
      <li>
        <a href="/posts/2025/02/pypy-gc-sampling.html" class="listtitle">Low Overhead Allocation Sampling with VMProf in PyPy's GC</a>
      </li>
      <li>
        <a href="/posts/2025/02/pypy-v7318-release.html" class="listtitle">PyPy v7.3.18 release</a>
      </li>
      <li>
        <a href="/posts/2025/01/musings-tracing.html" class="listtitle">Musings on Tracing in PyPy</a>
      </li>
      <li>
        <a href="/posts/2025/01/towards-pypy311-an-update.html" class="listtitle">Towards PyPy3.11 - an update</a>
      </li>
      <li>
        <a href="/posts/2024/11/guest-post-final-encoding-in-rpython.html" class="listtitle">Guest Post: Final Encoding in RPython Interpreters</a>
      </li>
      <li>
        <a href="/posts/2024/10/jit-peephole-dsl.html" class="listtitle">A DSL for Peephole Transformation Rules of Integer Operations in the PyPy JIT</a>
      </li>
    </ul>
  </div>

          <div id="global-archive-list">
          <h2>
            Archives
          </h2>
          <ul class="archive-level archive-level-1">
            <li><a class="reference" href="/2007/">2007</a> (19)
            </li>
            <li><a class="reference" href="/2008/">2008</a> (62)
            </li>
            <li><a class="reference" href="/2009/">2009</a> (38)
            </li>
            <li><a class="reference" href="/2010/">2010</a> (44)
            </li>
            <li><a class="reference" href="/2011/">2011</a> (43)
            </li>
            <li><a class="reference" href="/2012/">2012</a> (44)
            </li>
            <li><a class="reference" href="/2013/">2013</a> (46)
            </li>
            <li><a class="reference" href="/2014/">2014</a> (22)
            </li>
            <li><a class="reference" href="/2015/">2015</a> (20)
            </li>
            <li><a class="reference" href="/2016/">2016</a> (20)
            </li>
            <li><a class="reference" href="/2017/">2017</a> (13)
            </li>
            <li><a class="reference" href="/2018/">2018</a> (12)
            </li>
            <li><a class="reference" href="/2019/">2019</a> (12)
            </li>
            <li><a class="reference" href="/2020/">2020</a> (9)
            </li>
            <li><a class="reference" href="/2021/">2021</a> (10)
            </li>
            <li><a class="reference" href="/2022/">2022</a> (13)
            </li>
            <li><a class="reference" href="/2023/">2023</a> (6)
            </li>
            <li><a class="reference" href="/2024/">2024</a> (13)
            </li>
            <li><a class="reference" href="/2025/">2025</a> (8)
            </li>
          </ul>
        </div>


          <div id="global-tag-list">
          <h2>
            Tags
          </h2>
          <ul>
            <li><a class="reference" href="/categories/arm.html">arm</a> (2)</li>
            <li><a class="reference" href="/categories/benchmarking.html">benchmarking</a> (1)</li>
            <li><a class="reference" href="/categories/casestudy.html">casestudy</a> (3)</li>
            <li><a class="reference" href="/categories/cli.html">cli</a> (1)</li>
            <li><a class="reference" href="/categories/compiler.html">compiler</a> (1)</li>
            <li><a class="reference" href="/categories/conda-forge.html">conda-forge</a> (1)</li>
            <li><a class="reference" href="/categories/cpyext.html">cpyext</a> (4)</li>
            <li><a class="reference" href="/categories/cpython.html">CPython</a> (3)</li>
            <li><a class="reference" href="/categories/ep2008.html">ep2008</a> (1)</li>
            <li><a class="reference" href="/categories/extension-modules.html">extension modules</a> (3)</li>
            <li><a class="reference" href="/categories/gc.html">gc</a> (3)</li>
            <li><a class="reference" href="/categories/guestpost.html">guestpost</a> (3)</li>
            <li><a class="reference" href="/categories/graalpython.html">GraalPython</a> (1)</li>
            <li><a class="reference" href="/categories/hpy.html">hpy</a> (1)</li>
            <li><a class="reference" href="/categories/heptapod.html">Heptapod</a> (1)</li>
            <li><a class="reference" href="/categories/jit.html">jit</a> (23)</li>
            <li><a class="reference" href="/categories/jython.html">jython</a> (1)</li>
            <li><a class="reference" href="/categories/kcachegrind.html">kcachegrind</a> (1)</li>
            <li><a class="reference" href="/categories/meta.html">meta</a> (1)</li>
            <li><a class="reference" href="/categories/numpy.html">numpy</a> (24)</li>
            <li><a class="reference" href="/categories/parser.html">parser</a> (1)</li>
            <li><a class="reference" href="/categories/performance.html">performance</a> (2)</li>
            <li><a class="reference" href="/categories/profiling.html">profiling</a> (7)</li>
            <li><a class="reference" href="/categories/pypy.html">pypy</a> (6)</li>
            <li><a class="reference" href="/categories/pypy3.html">pypy3</a> (16)</li>
            <li><a class="reference" href="/categories/pyqt4.html">PyQt4</a> (1)</li>
            <li><a class="reference" href="/categories/release.html">release</a> (66)</li>
            <li><a class="reference" href="/categories/releasecffi.html">releasecffi</a> (3)</li>
            <li><a class="reference" href="/categories/releaserevdb.html">releaserevdb</a> (1)</li>
            <li><a class="reference" href="/categories/releasestm.html">releasestm</a> (1)</li>
            <li><a class="reference" href="/categories/revdb.html">revdb</a> (1)</li>
            <li><a class="reference" href="/categories/roadmap.html">roadmap</a> (2)</li>
            <li><a class="reference" href="/categories/rpython.html">rpython</a> (1)</li>
            <li><a class="reference" href="/categories/rpyc.html">RPyC</a> (1)</li>
            <li><a class="reference" href="/categories/speed.html">speed</a> (6)</li>
            <li><a class="reference" href="/categories/sponsors.html">sponsors</a> (7)</li>
            <li><a class="reference" href="/categories/sprint.html">sprint</a> (3)</li>
            <li><a class="reference" href="/categories/sprints.html">sprints</a> (1)</li>
            <li><a class="reference" href="/categories/stm.html">stm</a> (14)</li>
            <li><a class="reference" href="/categories/sun.html">sun</a> (1)</li>
            <li><a class="reference" href="/categories/smalltalk.html">Smalltalk</a> (1)</li>
            <li><a class="reference" href="/categories/squeak.html">Squeak</a> (1)</li>
            <li><a class="reference" href="/categories/testing.html">testing</a> (1)</li>
            <li><a class="reference" href="/categories/toy-optimizer.html">toy-optimizer</a> (5)</li>
            <li><a class="reference" href="/categories/unicode.html">unicode</a> (1)</li>
            <li><a class="reference" href="/categories/valgrind.html">valgrind</a> (1)</li>
            <li><a class="reference" href="/categories/vmprof.html">vmprof</a> (3)</li>
            <li><a class="reference" href="/categories/z3.html">z3</a> (5)</li>
          </ul>
        </div>    </div>
</article></main><footer id="footer"><p>
</p>
<div class="myfooter">
  <div class="logotext">
    Â© 2025 <a href="mailto:pypy-dev@pypy.org">The PyPy Team</a>
    Â 
    Built with <a href="https://getnikola.com" rel="nofollow">Nikola</a>
    Â 
    Last built 2025-07-07T11:01
  </div>
  <div style="margin-left: auto">
  <a href="../../../rss.xml">RSS feed</a>
</div>

            
        

    </div>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js" crossorigin="anonymous"></script><script src="../../../assets/js/styles.js"></script></footer>
</div>
</body>
</html>