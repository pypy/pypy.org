<!DOCTYPE html>
<html \ prefix="
        og: http://ogp.me/ns# article: http://ogp.me/ns/article#
    " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>STMGC-C7 with PyPy | PyPy</title>
<link href="../../../assets/css/rst_base.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_rst.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/styles.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../../rss.xml">
<link rel="canonical" href="https://www.pypy.org/posts/2014/03/hi-all-here-is-one-of-first-full-pypys-8725931424559481728.html">
<link rel="icon" href="../../../favicon2.ico" sizes="16x16">
<link rel="icon" href="../../../favicon32x32.ico" sizes="32x32">
<!--[if lt IE 9]><script src="../../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="../../../assets/css/tipuesearch.css">
<meta name="author" content="Armin Rigo">
<link rel="prev" href="hello-everyone-there-is-interview-with-7561523711224053700.html" title="PyPy on uWSGI" type="text/html">
<link rel="next" href="pygamecffi-pygame-on-pypy-8679802461301121984.html" title="pygame_cffi: pygame on PyPy" type="text/html">
<meta property="og:site_name" content="PyPy">
<meta property="og:title" content="STMGC-C7 with PyPy">
<meta property="og:url" content="https://www.pypy.org/posts/2014/03/hi-all-here-is-one-of-first-full-pypys-8725931424559481728.html">
<meta property="og:description" content="Hi all,

Here is one of the first full PyPy's
(edit: it was r69967+, but the general list of versions is currently here)
compiled with the new StmGC-c7
library.  It has no JIT so far, but it runs some">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2014-03-15T17:00:00Z">
<meta property="article:tag" content="stm">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="container">
             <header id="header"><!-- Adapted from https://www.taniarascia.com/responsive-dropdown-navigation-bar --><section class="navigation"><div class="nav-container">
            <div class="brand">
                <a href="../../../index.html">
                    <image id="toplogo" src="../../../images/pypy-logo.svg" width="75px;" alt="PyPy/"></image></a>
            </div>
            <nav><ul class="nav-list">
<li> 
                <a href="#!">Features</a>
                <ul class="nav-dropdown">
<li> <a href="../../../features.html">What is PyPy?</a> </li>  
                    <li> <a href="../../../compat.html">Compatibility</a> </li>  
                    <li> <a href="../../../performance.html">Performance</a> </li>  
                </ul>
</li>
          <li> <a href="../../../download.html">Download</a> </li>  
          <li> <a href="http://doc.pypy.org">Dev Docs</a> </li>  
            <li> 
                <a href="#!">Blog</a>
                <ul class="nav-dropdown">
<li> <a href="../../../blog/">Index</a> </li>  
                    <li> <a href="../../../categories/">Tags</a> </li>  
                    <li> <a href="../../../archive.html">Archive by year</a> </li>  
                    <li> <a href="../../../rss.xml">RSS feed</a> </li>  
                    <li> <a href="https://morepypy.blogspot.com/">Old site</a> </li>  
                </ul>
</li>
            <li> 
                <a href="#!">About</a>
                <ul class="nav-dropdown">
<li> <a href="https://bsky.app/profile/pypyproject.bsky.social">Bluesky</a> </li>  
                    <li> <a href="https://libera.irclog.whitequark.org/pypy">IRC logs</a> </li>  
                    <li> <a href="https://www.youtube.com/playlist?list=PLADqad94yVqDRQXuqxKrPS5QnVqbDLlRt">YouTube</a> </li>  
                    <li> <a href="https://www.twitch.tv/pypyproject">Twitch</a> </li>  
                    <li> <a href="../../../pypy-sponsors.html">Sponsors</a> </li>  
                    <li> <a href="../../../howtohelp.html">How To Help?</a> </li>  
                    <li> <a href="../../../contact.html">Contact</a> </li>  
                </ul>
</li>

                </ul></nav><div class="nav-mobile">
                <a id="nav-toggle" href="#!"> <span></span></a>
            </div>
        </div>
    </section><div class="searchform" role="search">
                
<form class="navbar-form navbar-left" action="../../../search.html" role="search">
    <div class="form-group">
        <input type="text" class="form-control" id="tipue_search_input" name="q" placeholder="Search…" autocomplete="off">
</div>
    <input type="submit" value="Local Search" style="visibility: hidden;">
</form>

            </div>
    </header><main id="content"><article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><div class="post">
          <header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">STMGC-C7 with PyPy</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../../authors/armin-rigo.html">Armin Rigo</a>
            </span></p>
            <p class="dateline">
            <a href="#" rel="bookmark">
            <time class="published dt-published" datetime="2014-03-15T17:00:00Z" itemprop="datePublished" title="2014-03-15 17:00">2014-03-15 17:00</time></a>
            </p>
                <p class="commentline">11 comments</p>

                <p class="commentline">            <a href="hi-all-here-is-one-of-first-full-pypys-8725931424559481728.html#utterances-thread">Comments</a>


            
        </p>
</div>
        
    </header><div class="e-content entry-content" itemprop="articleBody text">
      <p>Hi all,</p>

<p>Here is one of the first full PyPy's
(edit: it was r69967+, but the general list of versions is currently <a href="https://cobra.cs.uni-duesseldorf.de/~buildmaster/misc/">here</a>)
compiled with the new <a href="../02/rewrites-of-stm-core-model-again-633249729751034512.html">StmGC-c7
library</a>.  It has no JIT so far, but it runs some small
single-threaded benchmarks by taking around 40% more time than a
corresponding non-STM, no-JIT version of PyPy.  It scales --- up to two
threads only, which is the hard-coded maximum so far in the c7 code.
But the scaling looks perfect in these small benchmarks without
conflict: starting two threads each running a copy of the benchmark
takes almost exactly the same amount of total time, simply using two
cores.</p>

<p>Feel free to try it!  It is not actually useful so far, because it is
limited to two cores and CPython is something like 2.5x faster.  One of
the important next steps is to re-enable the JIT.  Based on our <a href="https://foss.heptapod.net/pypy/pypy/-/tree/branch//stmgc-c7/TODO">current
understanding</a> of the "40%" figure, we can probably reduce it with
enough efforts; but also, the JIT should be able to easily produce
machine code that suffers a bit less than the interpreter from these
effects.  This seems to mean that we're looking at 20%-ish slow-downs
for the future PyPy-STM-JIT.</p>

<p>Interesting times :-)</p>

<p>For reference, this is what you get by downloading <a href="https://cobra.cs.uni-duesseldorf.de/~buildmaster/misc/pypy-c-r69967+-stm-1d0b870195e7.tbz2">the
PyPy binary linked above</a>: a Linux 64 binary (Ubuntu 12.04) that
should behave mostly like a regular PyPy.  (One main missing feature is
that destructors are never called.)  It uses two cores, but obviously
only if the Python program you run is multithreaded.  The only new
built-in feature is <code>with __pypy__.thread.atomic:</code> this gives
you a way to enforce that a block of code runs "atomically", which means
without any operation from any other thread randomly interleaved.</p>

<p>If you want to translate it yourself, you need a trunk version of clang
with <a href="https://bitbucket.org/pypy/stmgc/raw/default/c7/llvmfix">three patches</a> applied.  That's the number of bugs that we couldn't
find workarounds for, not the total number of bugs we found by (ab)using
the <a href="https://clang.llvm.org/docs/LanguageExtensions.html#target-specific-extensions">address_space</a> feature...</p>

<p>Stay tuned for more!</p>

<p>Armin &amp; Remi</p>
      </div>
      <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../categories/stm.html" rel="tag">stm</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="hello-everyone-there-is-interview-with-7561523711224053700.html" rel="prev" title="PyPy on uWSGI">Previous post</a>
            </li>
            <li class="next">
                <a href="pygamecffi-pygame-on-pypy-8679802461301121984.html" rel="next" title="pygame_cffi: pygame on PyPy">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
                <div class="comment-level comment-level-1">
      <div class="comment comment-7745971750818505261">
        <div class="comment-header">
          <a name="comment-7745971750818505261"></a>
            <span class="author">Armin Rigo</span> wrote on <span class="date">2014-03-16 20:32</span>:
        </div>
        <div class="comment-content">
          <p>The provided pypy-c crashes when calling fork().  Sadly fork() is indirectly called by a lot of things, including the subprocess module --- which can be executed just by importing random modules...</p>
        </div>
      </div>
      <div class="comment comment-8004082123995338012">
        <div class="comment-header">
          <a name="comment-8004082123995338012"></a>
            <span class="author">Unknown</span> wrote on <span class="date">2014-03-17 08:39</span>:
        </div>
        <div class="comment-content">
          <p>That sounds pretty huge!<br><br>Do you require clang for that? (why is it named on https://foss.heptapod.net/pypy/pypy/-/tree/branch//stmgc-c7/TODO )</p>
        </div>
      </div>
      <div class="comment comment-3358716380887223056">
        <div class="comment-header">
          <a name="comment-3358716380887223056"></a>
            <span class="author">Armin Rigo</span> wrote on <span class="date">2014-03-17 20:42</span>:
        </div>
        <div class="comment-content">
          <p>Only clang has the address_space extension mention in the blog post; gcc does not.</p>
        </div>
      </div>
      <div class="comment comment-4440813128986138402">
        <div class="comment-header">
          <a name="comment-4440813128986138402"></a>
            <span class="author">Unknown</span> wrote on <span class="date">2014-03-19 13:51</span>:
        </div>
        <div class="comment-content">
          <p>I want to hear more talks on this.  When is your next talk... pycon 2014?  It would be hilarious if the pypy group were able to create naive concurrency in python, no one would have seen that coming!  Many would have thought, "surely Haskell", or some other immutable, static language would get us there first.  But no, it might just be that pypy allows any language that targets it to be concurrent, kiss style...amazing!  Anyway, enough gushing, time for a random question.  Mainstream vms like the JVM have added ways of speeding up dynamic languages, what advantages does pypy have over these traditional vms(other than the concurrency one that might come to fruition)?  I think this would be a good question to answer at the next talk for pypy.</p>
        </div>
      </div>
      <div class="comment comment-1830911613584343784">
        <div class="comment-header">
          <a name="comment-1830911613584343784"></a>
            <span class="author">Armin Rigo</span> wrote on <span class="date">2014-03-20 06:54</span>:
        </div>
        <div class="comment-content">
          <p>As it turns out there will be no PyPy talk at PyCon 2014.<br><br>The JVM runs Jython at a speed that is around that of CPython.  PyPy runs substantially faster than this.  One difference is that PyPy contains a small number of annotations targeted specifically towards RPython's JIT generator, whereas the JVM has no support for this.</p>
        </div>
      </div>
      <div class="comment comment-7516979993707582760">
        <div class="comment-header">
          <a name="comment-7516979993707582760"></a>
            <span class="author">Armin Rigo</span> wrote on <span class="date">2014-03-20 07:37</span>:
        </div>
        <div class="comment-content">
          <p>Update containing the most obvious fixes: https://cobra.cs.uni-duesseldorf.de/~buildmaster/misc/pypy-c-r70103-70091-stm.tbz2 (Ubuntu 12.04 Linux 64-bit)</p>
        </div>
      </div>
      <div class="comment comment-5887891256441897929">
        <div class="comment-header">
          <a name="comment-5887891256441897929"></a>
            <span class="author">Unknown</span> wrote on <span class="date">2014-03-20 15:45</span>:
        </div>
        <div class="comment-content">
          <p>Oh, I do not want to know personally about the superiority of pypy vs the jvm.  I was just suggesting a talking point; basically, show others that pypy is a better alternative(for dynamic languages, possibly all languages with naive concurrency working!) then llvm, jvm, etc...  I do have a question though, would you suppose that performance of pypy-stm would be better than that of something like the approach clojure has?  I have heard that immutable data structures are nice for correctness but that they are bad for performance.</p>
        </div>
      </div>
      <div class="comment comment-6049705667489488220">
        <div class="comment-header">
          <a name="comment-6049705667489488220"></a>
            <span class="author">Anonymous</span> wrote on <span class="date">2014-03-21 17:21</span>:
        </div>
        <div class="comment-content">
          <p>So PyPy-STM is Python without GIL? And it's possible to make it only 20% slower than "regular" PyPy? That would be quite an achievement.<br><br>Could you publish a build of PyPy-STM for Debian Stable?</p>
        </div>
      </div>
      <div class="comment comment-2785048928132293428">
        <div class="comment-header">
          <a name="comment-2785048928132293428"></a>
            <span class="author">Armin Rigo</span> wrote on <span class="date">2014-03-22 12:24</span>:
        </div>
        <div class="comment-content">
          <p>The PyPy-STM we have so far doesn't include any JIT.  If you want to try it out anyway on other Linux platforms than Ubuntu, you need to translate it yourself, or possibly hack around with symlinks and LD_LIBRARY_PATH.</p>
        </div>
      </div>
      <div class="comment comment-8162726717866983881">
        <div class="comment-header">
          <a name="comment-8162726717866983881"></a>
            <span class="author">Anonymous</span> wrote on <span class="date">2014-03-22 12:44</span>:
        </div>
        <div class="comment-content">
          <p>&gt; The PyPy-STM we have so far doesn't include any JIT<br><br>Yep, that's what blog post said :) But also PyPy-STM doesn't include GIL, does it?</p>
        </div>
      </div>
      <div class="comment comment-5761349177337727614">
        <div class="comment-header">
          <a name="comment-5761349177337727614"></a>
            <span class="author">Armin Rigo</span> wrote on <span class="date">2014-03-23 07:44</span>:
        </div>
        <div class="comment-content">
          <p>Indeed, which is the point :-)  You're welcome to try it out, but I'm just saying that I don't want to go to great lengths to provide precompiled binaries that work on Linux XYZ when I could basically release an updated version every couple of days...  It's still experimental and in-progress.  Early versions are limited to two cores; later versions to 4 cores.  We still have to determine the optimal number for this limit; maybe around 8? (higher numbers imply a bit of extra overheads)  It's an example of in-progress work.  Another example is that so far you don't get feedback from cross-transaction conflicts; you used to in previous versions, but we didn't port it yet.</p>
        </div>
      </div>
         </div>

          </section>
</div>
    <div class="sidebar">
<div>
  <h2>
    The PyPy blogposts
  </h2>
  <div>
    Create a guest post via a PR to the <a href="https://github.com/pypy/pypy.org">source repo</a>
  </div>
</div>
    <div id="global-recent-posts">
    <h2>
      Recent Posts
    </h2>
    <ul class="post-list">
      <li>
        <a href="/posts/2025/12/toy-load-store.html" class="listtitle">Load and store forwarding in the Toy Optimizer</a>
      </li>
      <li>
        <a href="/posts/2025/07/pypy-v7320-release.html" class="listtitle">PyPy v7.3.20 release</a>
      </li>
      <li>
        <a href="/posts/2025/06/rpython-gc-allocation-speed.html" class="listtitle">How fast can the RPython GC allocate?</a>
      </li>
      <li>
        <a href="/posts/2025/04/prospero-in-rpython.html" class="listtitle">Doing the Prospero-Challenge in RPython</a>
      </li>
      <li>
        <a href="/posts/2025/02/pypy-v7319-release.html" class="listtitle">PyPy v7.3.19 release</a>
      </li>
      <li>
        <a href="/posts/2025/02/pypy-gc-sampling.html" class="listtitle">Low Overhead Allocation Sampling with VMProf in PyPy's GC</a>
      </li>
      <li>
        <a href="/posts/2025/02/pypy-v7318-release.html" class="listtitle">PyPy v7.3.18 release</a>
      </li>
      <li>
        <a href="/posts/2025/01/musings-tracing.html" class="listtitle">Musings on Tracing in PyPy</a>
      </li>
      <li>
        <a href="/posts/2025/01/towards-pypy311-an-update.html" class="listtitle">Towards PyPy3.11 - an update</a>
      </li>
      <li>
        <a href="/posts/2024/11/guest-post-final-encoding-in-rpython.html" class="listtitle">Guest Post: Final Encoding in RPython Interpreters</a>
      </li>
    </ul>
  </div>

          <div id="global-archive-list">
          <h2>
            Archives
          </h2>
          <ul class="archive-level archive-level-1">
            <li><a class="reference" href="/2007/">2007</a> (19)
            </li>
            <li><a class="reference" href="/2008/">2008</a> (62)
            </li>
            <li><a class="reference" href="/2009/">2009</a> (38)
            </li>
            <li><a class="reference" href="/2010/">2010</a> (44)
            </li>
            <li><a class="reference" href="/2011/">2011</a> (43)
            </li>
            <li><a class="reference" href="/2012/">2012</a> (44)
            </li>
            <li><a class="reference" href="/2013/">2013</a> (46)
            </li>
            <li><a class="reference" href="/2014/">2014</a> (22)
            </li>
            <li><a class="reference" href="/2015/">2015</a> (20)
            </li>
            <li><a class="reference" href="/2016/">2016</a> (20)
            </li>
            <li><a class="reference" href="/2017/">2017</a> (13)
            </li>
            <li><a class="reference" href="/2018/">2018</a> (12)
            </li>
            <li><a class="reference" href="/2019/">2019</a> (12)
            </li>
            <li><a class="reference" href="/2020/">2020</a> (9)
            </li>
            <li><a class="reference" href="/2021/">2021</a> (10)
            </li>
            <li><a class="reference" href="/2022/">2022</a> (13)
            </li>
            <li><a class="reference" href="/2023/">2023</a> (6)
            </li>
            <li><a class="reference" href="/2024/">2024</a> (13)
            </li>
            <li><a class="reference" href="/2025/">2025</a> (9)
            </li>
          </ul>
        </div>


          <div id="global-tag-list">
          <h2>
            Tags
          </h2>
          <ul>
            <li><a class="reference" href="/categories/arm.html">arm</a> (2)</li>
            <li><a class="reference" href="/categories/benchmarking.html">benchmarking</a> (1)</li>
            <li><a class="reference" href="/categories/casestudy.html">casestudy</a> (3)</li>
            <li><a class="reference" href="/categories/cli.html">cli</a> (1)</li>
            <li><a class="reference" href="/categories/compiler.html">compiler</a> (1)</li>
            <li><a class="reference" href="/categories/conda-forge.html">conda-forge</a> (1)</li>
            <li><a class="reference" href="/categories/cpyext.html">cpyext</a> (4)</li>
            <li><a class="reference" href="/categories/cpython.html">CPython</a> (3)</li>
            <li><a class="reference" href="/categories/ep2008.html">ep2008</a> (1)</li>
            <li><a class="reference" href="/categories/extension-modules.html">extension modules</a> (3)</li>
            <li><a class="reference" href="/categories/gc.html">gc</a> (3)</li>
            <li><a class="reference" href="/categories/guestpost.html">guestpost</a> (3)</li>
            <li><a class="reference" href="/categories/graalpython.html">GraalPython</a> (1)</li>
            <li><a class="reference" href="/categories/hpy.html">hpy</a> (1)</li>
            <li><a class="reference" href="/categories/heptapod.html">Heptapod</a> (1)</li>
            <li><a class="reference" href="/categories/jit.html">jit</a> (23)</li>
            <li><a class="reference" href="/categories/jython.html">jython</a> (1)</li>
            <li><a class="reference" href="/categories/kcachegrind.html">kcachegrind</a> (1)</li>
            <li><a class="reference" href="/categories/meta.html">meta</a> (1)</li>
            <li><a class="reference" href="/categories/numpy.html">numpy</a> (24)</li>
            <li><a class="reference" href="/categories/parser.html">parser</a> (1)</li>
            <li><a class="reference" href="/categories/performance.html">performance</a> (2)</li>
            <li><a class="reference" href="/categories/profiling.html">profiling</a> (7)</li>
            <li><a class="reference" href="/categories/pypy.html">pypy</a> (6)</li>
            <li><a class="reference" href="/categories/pypy3.html">pypy3</a> (16)</li>
            <li><a class="reference" href="/categories/pyqt4.html">PyQt4</a> (1)</li>
            <li><a class="reference" href="/categories/release.html">release</a> (66)</li>
            <li><a class="reference" href="/categories/releasecffi.html">releasecffi</a> (3)</li>
            <li><a class="reference" href="/categories/releaserevdb.html">releaserevdb</a> (1)</li>
            <li><a class="reference" href="/categories/releasestm.html">releasestm</a> (1)</li>
            <li><a class="reference" href="/categories/revdb.html">revdb</a> (1)</li>
            <li><a class="reference" href="/categories/roadmap.html">roadmap</a> (2)</li>
            <li><a class="reference" href="/categories/rpython.html">rpython</a> (1)</li>
            <li><a class="reference" href="/categories/rpyc.html">RPyC</a> (1)</li>
            <li><a class="reference" href="/categories/speed.html">speed</a> (6)</li>
            <li><a class="reference" href="/categories/sponsors.html">sponsors</a> (7)</li>
            <li><a class="reference" href="/categories/sprint.html">sprint</a> (3)</li>
            <li><a class="reference" href="/categories/sprints.html">sprints</a> (1)</li>
            <li><a class="reference" href="/categories/stm.html">stm</a> (14)</li>
            <li><a class="reference" href="/categories/sun.html">sun</a> (1)</li>
            <li><a class="reference" href="/categories/smalltalk.html">Smalltalk</a> (1)</li>
            <li><a class="reference" href="/categories/squeak.html">Squeak</a> (1)</li>
            <li><a class="reference" href="/categories/testing.html">testing</a> (1)</li>
            <li><a class="reference" href="/categories/toy-optimizer.html">toy-optimizer</a> (6)</li>
            <li><a class="reference" href="/categories/unicode.html">unicode</a> (1)</li>
            <li><a class="reference" href="/categories/valgrind.html">valgrind</a> (1)</li>
            <li><a class="reference" href="/categories/vmprof.html">vmprof</a> (3)</li>
            <li><a class="reference" href="/categories/z3.html">z3</a> (5)</li>
          </ul>
        </div>    </div>
</article></main><footer id="footer"><p>
</p>
<div class="myfooter">
  <div class="logotext">
    © 2026 <a href="mailto:pypy-dev@pypy.org">The PyPy Team</a>
     
    Built with <a href="https://getnikola.com" rel="nofollow">Nikola</a>
     
    Last built 2026-01-17T00:22
  </div>
  <div style="margin-left: auto">
  <a href="../../../rss.xml">RSS feed</a>
</div>

            
        

    </div>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js" crossorigin="anonymous"></script><script src="../../../assets/js/styles.js"></script></footer>
</div>
</body>
</html>