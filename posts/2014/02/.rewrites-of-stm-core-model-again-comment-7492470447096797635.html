<html><body><p>Did you consider existing STM libraries in your implementation? It might be worthwhile to take a look at stasis (https://code.google.com/p/stasis/) which has a pretty complete set of features.<br><br>https://www.eecs.berkeley.edu/Pubs/TechRpts/2010/EECS-2010-2.pdf</p></body></html>